# èœå•ç®¡ç†æ¨¡å— API éœ€æ±‚æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **æ¨¡å—åç§°**: èœå•ç®¡ç† (Menu Management)
- **æ‰€å±ç³»ç»Ÿ**: æ•°æ®è¯­ä¹‰æ²»ç†å¹³å° - å¹³å°ç®¡ç†
- **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2026-01-21
- **API åŸºç¡€è·¯å¾„**: `/api/v1/menu-management`

---

## 1. ä¸šåŠ¡æ¦‚è¿°

### 1.1 åŠŸèƒ½å®šä½

èœå•ç®¡ç†æ¨¡å—è´Ÿè´£ç»´æŠ¤å¹³å°çš„å‰ç«¯è·¯ç”±ç»“æ„ã€å¯¼èˆªèœå•ä»¥åŠä¸ RBAC æƒé™çš„æ˜ å°„å…³ç³»ã€‚å®ƒæ˜¯ç³»ç»Ÿå¯¼èˆªæ¶æ„çš„åŸºçŸ³ï¼Œèƒ½å¤ŸåŠ¨æ€æ§åˆ¶ç”¨æˆ·åœ¨ä¸åŒæƒé™ä¸‹å¯è§çš„èœå•é¡¹å’Œæ“ä½œæŒ‰é’®ã€‚

### 1.2 æ ¸å¿ƒèƒ½åŠ›

- **èœå•æ ‘ç»´æŠ¤**: æ”¯æŒæ— é™å±‚çº§çš„èœå•/ç›®å½•ç»“æ„ã€‚
- **æƒé™ç»‘å®š**: å°†èœå•/æŒ‰é’®ä¸åç«¯æƒé™æ ‡è¯† (Permission Key) ç»‘å®šã€‚
- **åŠ¨æ€è·¯ç”±**: ä¸ºå‰ç«¯æä¾›åŠ¨æ€è·¯ç”±é…ç½®æ•°æ®ã€‚
- **å†…ç½®ä¿æŠ¤**: å…³é”®ç³»ç»Ÿèœå•æ ‡è®°ä¸º"å†…ç½®"ï¼Œé˜²æ­¢è¯¯åˆ é™¤ã€‚

---

## 2. æ•°æ®æ¨¡å‹

### 2.1 èœå•å®ä½“ (Menu)

```typescript
{
  id: string;                     // èœå•å”¯ä¸€æ ‡è¯†
  parentId: string | null;        // çˆ¶çº§èœå• ID (null ä¸ºé¡¶çº§)
  name: string;                   // èœå•åç§° (å¦‚: "ç”¨æˆ·ç®¡ç†")
  code: string;                   // èœå•ç¼–ç  (å¦‚: "user_mgmt")
  path: string;                   // è·¯ç”±è·¯å¾„ (å¦‚: "/platform/users")
  type: 'ç›®å½•' | 'é¡µé¢' | 'æ“ä½œ' | 'å¤–é“¾';  // èœå•ç±»å‹
  
  // å±•ç¤ºå±æ€§
  icon?: string;                  // å›¾æ ‡æ ‡è¯† (Lucide Icon Name)
  order: number;                  // æ’åºæƒé‡ (æ•°å€¼è¶Šå°è¶Šé å‰)
  group: string;                  // åˆ†ç»„åç§° (å¦‚: "å¹³å°ç®¡ç†", "è¯­ä¹‰æ²»ç†")
  visibility: 'æ˜¾ç¤º' | 'éšè—';      // å¯¼èˆªæ å¯è§æ€§
  
  // çŠ¶æ€å±æ€§
  status: 'å¯ç”¨' | 'åœç”¨';          // å¯ç”¨çŠ¶æ€ (åœç”¨åä¸å¯è®¿é—®)
  builtIn: boolean;               // æ˜¯å¦å†…ç½® (true åˆ™ä¸å¯åˆ é™¤)
  
  // æƒé™å±æ€§
  permission?: string;            // æƒé™æ ‡è¯† (å¦‚: "manage_user")
  associatedRoles?: string[];     // å…³è”çš„ RBAC è§’è‰² ID åˆ—è¡¨ (åªè¯»ï¼Œç”±æƒé™ç³»ç»Ÿæ¨å¯¼)
  
  // å¤–é“¾å±æ€§
  url?: string;                   // å¤–é“¾åœ°å€
  openMode?: 'æ–°çª—å£' | 'å½“å‰';     // æ‰“å¼€æ–¹å¼
  
  // å®¡è®¡ä¿¡æ¯
  owner: string;                  // ç»´æŠ¤äºº
  createdAt: string;              // åˆ›å»ºæ—¶é—´
  updatedAt: string;              // æ›´æ–°æ—¶é—´
  updatedBy: string;              // æœ€åä¿®æ”¹äºº
}
```

### 2.2 èœå•ç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **ç›®å½•** | ä»…ä½œä¸ºæŠ˜å å®¹å™¨ï¼Œæ— å®é™…é¡µé¢å†…å®¹ | "å¹³å°ç®¡ç†" |
| **é¡µé¢** | å…·ä½“çš„ä¸šåŠ¡é¡µé¢ï¼Œå¯¹åº”å‰ç«¯è·¯ç”± | "ç”¨æˆ·ç®¡ç†"ã€"æ¨¡å‹è®¾è®¡å™¨" |
| **æ“ä½œ** | é¡µé¢å†…çš„å…·ä½“åŠŸèƒ½æŒ‰é’® (ç»†ç²’åº¦æƒé™æ§åˆ¶) | "å¯¼å‡ºæ•°æ®"ã€"å®¡æ ¸é€šè¿‡" |
| **å¤–é“¾** | è·³è½¬åˆ°å¤–éƒ¨ç³»ç»Ÿçš„é“¾æ¥ | "å¸®åŠ©æ–‡æ¡£"ã€"å…¬å¸å®˜ç½‘" |

---

## 3. API æ¥å£è®¾è®¡

### 3.1 è·å–å®Œæ•´èœå•æ ‘

**æ¥å£**: `GET /api/v1/menu-management/menus`

**åŠŸèƒ½**: è·å–æ‰€æœ‰èœå•æ•°æ®ï¼Œé€šå¸¸ç”¨äºç®¡ç†ç«¯çš„åˆ—è¡¨å±•ç¤ºå’Œç¼–è¾‘ã€‚

**è¯·æ±‚å‚æ•°**:
```typescript
{
  keyword?: string;       // æŒ‰åç§°/ç¼–ç æœç´¢
  status?: 'å¯ç”¨' | 'åœç”¨' | 'éšè—';
  group?: string;         // æŒ‰åˆ†ç»„ç­›é€‰
  flat?: boolean;         // true=è¿”å›æ‰å¹³åˆ—è¡¨, false=è¿”å›æ ‘å½¢ç»“æ„ (é»˜è®¤ false)
}
```

**å“åº”**:
```typescript
{
  code: number;
  message: string;
  data: MenuNode[]; // æ ‘å½¢ç»“æ„æˆ–æ‰å¹³åˆ—è¡¨
}
```

### 3.2 è·å–å½“å‰ç”¨æˆ·å¯¼èˆªèœå•

**æ¥å£**: `GET /api/v1/menu-management/my-nav`

**åŠŸèƒ½**: è·å–å½“å‰ç™»å½•ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„èœå•æ ‘ (ç”¨äºå‰ç«¯ Layout æ¸²æŸ“ä¾§è¾¹æ )ã€‚

**ä¸šåŠ¡è§„åˆ™**:
1. è¿‡æ»¤æ‰ `status='åœç”¨'` çš„èœå•ã€‚
2. è¿‡æ»¤æ‰ `visibility='éšè—'` çš„èœå• (é™¤éæ˜¾å¼è¯·æ±‚åŒ…å«éšè—é¡¹)ã€‚
3. æ ¹æ®ç”¨æˆ·æ‹¥æœ‰çš„ Permissions è¿›è¡Œè¿‡æ»¤ï¼Œä»…è¿”å›æœ‰æƒé™çš„èœå•é¡¹ã€‚
4. ä»…è¿”å› `ç±»å‹` ä¸º `ç›®å½•`ã€`é¡µé¢`ã€`å¤–é“¾` çš„é¡¹ï¼Œè¿‡æ»¤æ‰ `æ“ä½œ` æŒ‰é’®ã€‚

### 3.3 åˆ›å»ºèœå•

**æ¥å£**: `POST /api/v1/menu-management/menus`

**è¯·æ±‚ä½“**:
```typescript
{
  name: string;           // å¿…å¡«
  code: string;           // å¿…å¡«ï¼Œå…¨å±€å”¯ä¸€
  path?: string;          // é¡µé¢/ç›®å½• å¿…å¡«
  type: MenuType;         // å¿…å¡«
  parentId?: string;
  group?: string;
  permission?: string;    // ç»‘å®šæƒé™æ ‡è¯†
  // ... å…¶ä»–éå¿…å¡«å­—æ®µ
}
```

**ä¸šåŠ¡è§„åˆ™**:
1. `code` å¿…é¡»å…¨å±€å”¯ä¸€ã€‚
2. `path` åœ¨åŒçº§ç›®å½•ä¸‹é€šå¸¸åº”å”¯ä¸€ã€‚
3. å¦‚æœ `type='é¡µé¢'`ï¼Œå»ºè®®ç»‘å®š `permission`ã€‚

### 3.4 æ›´æ–°èœå•

**æ¥å£**: `PUT /api/v1/menu-management/menus/:id`

**åŠŸèƒ½**: ä¿®æ”¹èœå•ä¿¡æ¯ã€‚

**ä¸šåŠ¡è§„åˆ™**:
1. å†…ç½®èœå• (`builtIn=true`) ä¸å…è®¸ä¿®æ”¹ `code` å’Œ `permission`ï¼Œé˜²æ­¢ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½å¤±æ•ˆã€‚
2. è‹¥ä¿®æ”¹äº† `parentId` (ç§»åŠ¨èœå•)ï¼Œéœ€æ£€æŸ¥æ˜¯å¦æ„æˆå¾ªç¯å¼•ç”¨ã€‚

### 3.5 åˆ é™¤èœå•

**æ¥å£**: `DELETE /api/v1/menu-management/menus/:id`

**ä¸šåŠ¡è§„åˆ™**:
1. å†…ç½®èœå• (`builtIn=true`) **ç¦æ­¢åˆ é™¤**ã€‚
2. è‹¥èœå•åŒ…å«å­èœå• (children)ï¼Œ**ç¦æ­¢ç›´æ¥åˆ é™¤**ï¼Œéœ€å…ˆåˆ é™¤æˆ–ç§»åŠ¨å­èœå•ã€‚

### 3.6 æ‰¹é‡æ›´æ–°çŠ¶æ€

**æ¥å£**: `PATCH /api/v1/menu-management/menus/batch-status`

**åŠŸèƒ½**: æ‰¹é‡ å¯ç”¨/åœç”¨/éšè— èœå•ã€‚

**è¯·æ±‚ä½“**:
```typescript
{
  ids: string[];
  status?: 'å¯ç”¨' | 'åœç”¨';
  visibility?: 'æ˜¾ç¤º' | 'éšè—';
}
```

### 3.7 èœå•ç»Ÿè®¡æ¦‚è§ˆ (KPI)

**æ¥å£**: `GET /api/v1/menu-management/stats`

**åŠŸèƒ½**: è·å–èœå•ç®¡ç†çš„ç»Ÿè®¡æŒ‡æ ‡ã€‚

**å“åº”**:
```typescript
{
  data: {
    totalCount: number;      // èœå•æ€»æ•°
    enabledCount: number;    // å¯ç”¨èœå•æ•°
    hiddenCount: number;     // éšè—èœå•æ•°
    unlinkedCount: number;   // æœªç»‘å®šæƒé™çš„é¡µé¢æ•° (é«˜å±é£é™©æç¤º)
  }
}
```

---

## 4. æƒé™æ§åˆ¶

| æ¥å£ | å¹³å°ç®¡ç†å‘˜ | æ™®é€šç”¨æˆ· |
|------|-----------|---------|
| ç®¡ç†åˆ—è¡¨ (æŸ¥) | âœ“ | âœ— |
| ç”¨æˆ·å¯¼èˆª (æŸ¥) | âœ“ | âœ“ |
| åˆ›å»º/ç¼–è¾‘/åˆ é™¤ | âœ“ | âœ— |
| æ‰¹é‡æ“ä½œ | âœ“ | âœ— |

---

## 5. é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ |
|-------|------|
| 409 | èœå•ç¼–ç å·²å­˜åœ¨ (Duplicate Code) |
| 422 | æ— æ³•åˆ é™¤éç©ºç›®å½• (Has Children) |
| 403 | æ— æ³•æ“ä½œå†…ç½®èœå• (Built-in Protected) |
